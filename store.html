<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MineRise ‚Äî Store (Automatic Currency Detection)</title>

  <style>
    /* --- inline CSS (same style as earlier, trimmed) --- */
    :root{
      --bg-0:#070617; --bg-1:#0b1222; --card:#071a2b; --muted:#b6c6db;
      --accent-1:#ff8a2b; --accent-2:#ff5d3a; --text:#eef6ff; --radius:14px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }
    [data-theme="light"]{ --bg-0:#f7fbff; --bg-1:#f2f6fb; --card:#ffffff; --muted:#445a73; --text:#071026; }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      min-height:100vh;
      background: radial-gradient(800px 420px at 10% 6%, rgba(255,138,43,0.03), transparent 6%), linear-gradient(180deg,var(--bg-0) 0%, var(--bg-1) 70%);
      color:var(--text); padding:24px;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    .site{ width:1200px; max-width:96%; margin:0 auto; display:flex; flex-direction:column; gap:18px; position:relative; z-index:1; }
    header{ display:flex; align-items:center; justify-content:space-between; padding:14px; border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border:1px solid rgba(255,255,255,0.03) }
    .brand{ display:flex; gap:12px; align-items:center }
    .logo{ width:64px; height:64px; border-radius:14px; display:flex; align-items:center; justify-content:center; font-weight:900; color:#05121a; background:linear-gradient(135deg,var(--accent-1),var(--accent-2)); box-shadow:0 10px 30px rgba(255,106,43,0.08) }
    nav{ display:flex; gap:10px; align-items:center }
    .nav-btn{ padding:8px 12px; border-radius:10px; background:transparent; border:1px solid rgba(255,255,255,0.03); color:var(--text); text-decoration:none; font-weight:700; cursor:pointer}
    .nav-btn.active{ background:linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:#07121a; box-shadow:0 10px 30px rgba(255,106,43,0.12) }
    .theme-btn{ padding:8px 10px; border-radius:10px; background:transparent; border:1px solid rgba(255,255,255,0.03); cursor:pointer }

    #three-container{ position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden }
    .fog-overlay{ position:fixed; left:-8%; right:-8%; bottom:-10%; height:420px; pointer-events:none; background:radial-gradient(ellipse at center, rgba(255,106,0,0.04), transparent 30%); filter:blur(40px); opacity:.95; mix-blend-mode:screen; z-index:0; animation:slow-drift 16s linear infinite }
    @keyframes slow-drift{0%{transform:translateX(0)}50%{transform:translateX(36px)}100%{transform:translateX(0)}}

    .card{ background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent); padding:14px; border-radius:12px; border:1px solid rgba(255,255,255,0.02) }
    .store-grid{ display:grid; gap:20px; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); margin-top:18px; align-items:start }
    .rank-card{ position:relative; overflow:hidden; border-radius:14px; padding:18px; display:flex; flex-direction:column; gap:10px; min-height:220px; color:var(--text); box-shadow:0 8px 30px rgba(2,8,20,0.5); transform:translateZ(0); }
    .rank-title{ font-size:18px; font-weight:800; letter-spacing:0.6px; margin:0; }
    .rank-desc{ color:rgba(255,255,255,0.85); opacity:0.95; font-size:13px }
    .rank-footer{ margin-top:auto; display:flex; justify-content:space-between; align-items:center; gap:10px }

    /* specific rank colors */
    .rank-bat{ background: linear-gradient(180deg, rgba(18,18,18,0.98), rgba(6,6,6,0.9)); border:1px solid rgba(255,255,255,0.03); }
    .rank-warden{ background: linear-gradient(180deg, rgba(58,20,85,0.92), rgba(30,10,70,0.88)); border:1px solid rgba(120,70,180,0.12); }
    .rank-rise{ background: linear-gradient(120deg, #ff6fa8 0%, #ffd5e8 50%, #ffffff 100%); color:#07121a; border:1px solid rgba(0,0,0,0.06); }

    .rank-badge{ padding:6px 10px;border-radius:999px;font-weight:800;font-size:13px; background:rgba(0,0,0,0.15);backdrop-filter: blur(6px); color:#fff }
    .card-cta{ padding:10px 14px; border-radius:10px; font-weight:800; cursor:pointer; border:0 }
    .card-cta.ghost{ background: rgba(255,255,255,0.06); color:var(--text) }
    .card-cta.primary{ background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:#07121a }

    /* extras cards */
    .extra-card { background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02)); border-radius:14px; padding:16px; min-height:150px; display:flex; flex-direction:column; gap:10px; }
    .extra-title { font-weight:800; font-size:16px; }
    .balance { margin-top:8px; color:var(--muted); font-size:13px; }

    /* toast */
    .toast { position:fixed; right:20px; bottom:20px; background:#07121a; color:#dff6ee; padding:10px 14px; border-radius:10px; box-shadow:0 10px 30px rgba(2,8,20,0.6); z-index:9999; display:none; }

    footer{ text-align:left; color:var(--muted); padding:12px; margin-top:8px }
    @media (max-width:900px){ .store-grid{ grid-template-columns:1fr } }
  </style>
</head>
<body>
  <div id="three-container" aria-hidden="true"></div>
  <div class="fog-overlay" aria-hidden="true"></div>

  <div class="site">
    <header>
      <div class="brand">
        <div class="logo">MR</div>
        <div><h1>MineRise Store</h1><p class="muted">Automatic currency detection ‚Ä¢ Play.MineRise.Fun</p></div>
      </div>

      <nav>
        <a class="nav-btn" href="index.html">Home</a>
        <a class="nav-btn active" href="store.html">Store</a>
        <a class="nav-btn" href="gallery.html">Gallery</a>
        <a class="nav-btn" href="connect.html">Connect</a>
        <button id="theme-toggle" class="theme-btn">üåô</button>
      </nav>
    </header>

    <main>
      <section class="card">
        <h2>Ranks ‚Äî localized prices</h2>
        <p class="muted">Visitors see prices in their local currency automatically. (Static rates used ‚Äî replace with live API for production.)</p>

        <div class="store-grid">
          <!-- BAT (base USD 0.99 - example) -->
          <div class="rank-card rank-bat tilt lift" data-rank="bat" aria-label="Bat rank - lowest">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
              <div>
                <div class="rank-title">ü¶á Bat</div>
                <div class="rank-desc">Entry rank ‚Äî basics & starter cosmetics.</div>
              </div>
              <div class="rank-badge">Lowest</div>
            </div>

            <div style="margin-top:12px;color:rgba(255,255,255,0.9)">
              <ul style="margin:0;padding-left:18px;color:rgba(255,255,255,0.8)">
                <li>Starter kit</li>
                <li>Access to seasonal events</li>
                <li>Daily key reward (1/day if you have a rank)</li>
              </ul>
            </div>

            <div class="rank-footer">
              <!-- data-price-usd used for conversion (base USD) -->
              <div class="price" data-price-usd="0.99">Loading‚Ä¶</div>

              <div style="display:flex;gap:8px">
                <button class="card-cta ghost" data-buy-price-usd="0.99" onclick="gift('bat')">Gift</button>
                <button class="card-cta primary" data-buy-price-usd="0.99" onclick="buy('bat')">Buy</button>
              </div>
            </div>
          </div>

          <!-- WARDEN (base USD 4.49) -->
          <div class="rank-card rank-warden tilt lift" data-rank="warden" aria-label="Warden rank - purple">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
              <div>
                <div class="rank-title">üõ°Ô∏è Warden</div>
                <div class="rank-desc">Balanced mid-tier rank with extra perks.</div>
              </div>
              <div class="rank-badge">Popular</div>
            </div>

            <div style="margin-top:12px;color:rgba(255,255,255,0.95)">
              <ul style="margin:0;padding-left:18px;color:rgba(255,255,255,0.85)">
                <li>Priority queue</li>
                <li>Custom tag & extra claims</li>
                <li>Exclusive Halloween aura</li>
                <li>Daily key reward (1/day if you have a rank)</li>
              </ul>
            </div>

            <div class="rank-footer">
              <div class="price" data-price-usd="4.49">Loading‚Ä¶</div>

              <div style="display:flex;gap:8px">
                <button class="card-cta ghost" data-buy-price-usd="4.49" onclick="gift('warden')">Gift</button>
                <button class="card-cta primary" data-buy-price-usd="4.49" onclick="buy('warden')">Buy</button>
              </div>
            </div>
          </div>

          <!-- RISE (base USD 19.99) -->
          <div class="rank-card rank-rise tilt lift" data-rank="rise" aria-label="Rise rank - pink to white">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
              <div>
                <div class="rank-title">üå∏ Rise</div>
                <div class="rank-desc" style="opacity:0.95">Premium rank with top cosmetics and perks.</div>
              </div>
              <div class="rank-badge">Premium</div>
            </div>

            <div style="margin-top:12px;color:rgba(0,0,0,0.85)">
              <ul style="margin:0;padding-left:18px;color:rgba(0,0,0,0.78)">
                <li>VIP island</li>
                <li>Exclusive mounts & cosmetics</li>
                <li>Access to staff channel</li>
                <li>Daily key reward (1/day if you have a rank)</li>
              </ul>
            </div>

            <div class="rank-footer">
              <div class="price" data-price-usd="19.99">Loading‚Ä¶</div>

              <div style="display:flex;gap:8px">
                <button class="card-cta ghost" data-buy-price-usd="19.99" onclick="gift('rise')">Gift</button>
                <button class="card-cta primary" data-buy-price-usd="19.99" onclick="buy('rise')">Buy</button>
              </div>
            </div>
          </div>

        </div>
      </section>

      <!-- Extras section (Keys, Rank Keys, Shards, Coins) -->
      <section class="card" style="margin-top:18px;">
        <h2>Extras ‚Äî Keys / Shards / Coins</h2>
        <p class="muted">Buy keys, rank keys, shards or coins. Ranks give 1 free key per day (local-only demo).</p>

        <div class="store-grid" style="margin-top:12px;">
          <div class="extra-card tilt" id="card-key">
            <div class="extra-title">üîë Key</div>
            <div class="muted">Opens general crates</div>
            <div class="price" data-price-usd="0.99">Loading‚Ä¶</div>
            <div style="display:flex;gap:8px;margin-top:8px;">
              <button class="card-cta ghost" data-buy-price-usd="0.99" onclick="buy('key')">Buy</button>
              <button class="card-cta primary" onclick="claimDailyKey()">Claim daily key</button>
            </div>
            <div class="balance" id="balance-keys">Keys: 0</div>
          </div>

          <div class="extra-card tilt" id="card-rankkey">
            <div class="extra-title">üóùÔ∏è Rank Key</div>
            <div class="muted">Opens rank-only crates</div>
            <div class="price" data-price-usd="1.99">Loading‚Ä¶</div>
            <div style="display:flex;gap:8px;margin-top:8px;">
              <button class="card-cta ghost" data-buy-price-usd="1.99" onclick="buy('rankKey')">Buy</button>
            </div>
            <div class="balance" id="balance-rankkeys">Rank Keys: 0</div>
          </div>

          <div class="extra-card tilt" id="card-shards">
            <div class="extra-title">üíé Shard Pack</div>
            <div class="muted">Used to craft exclusive cosmetics</div>
            <div class="price" data-price-usd="2.99">Loading‚Ä¶</div>
            <div style="display:flex;gap:8px;margin-top:8px;">
              <button class="card-cta ghost" data-buy-price-usd="2.99" onclick="buy('shards')">Buy</button>
            </div>
            <div class="balance" id="balance-shards">Shards: 0</div>
          </div>

          <div class="extra-card tilt" id="card-coins">
            <div class="extra-title">ü™ô Coin Pack</div>
            <div class="muted">Spend coins on cosmetics</div>
            <div class="price" data-price-usd="0.49">Loading‚Ä¶</div>
            <div style="display:flex;gap:8px;margin-top:8px;">
              <button class="card-cta ghost" data-buy-price-usd="0.49" onclick="buy('coins')">Buy</button>
            </div>
            <div class="balance" id="balance-coins">Coins: 0</div>
          </div>
        </div>
      </section>

    </main>

    <footer>¬© MineRise ‚Ä¢ play.minerise.fun</footer>
  </div>

  <div class="toast" id="toast"></div>

  <!-- ===== currency detection + conversion script (single-file) ===== -->
  <script>
  (function () {
    // --- Static exchange rates (approx) relative to USD.
    // Replace with a live API for production accuracy.
    const exchangeRates = {
      USD:1, EUR:0.92, GBP:0.79, INR:83.5, CAD:1.35, AUD:1.56, JPY:156.3, BRL:5.20,
      RUB:96, ZAR:18.5, NGN:1180, PKR:284, CNY:7.20, KRW:1340, MXN:17.2, ARS:900,
      TRY:35, SAR:3.76, AED:3.67, SEK:10.6, NOK:11.4, CHF:0.91, NZD:1.70, DKK:6.9,
      HKD:7.82, SGD:1.35, MYR:4.75, IDR:15600, THB:35.7, VND:24600, HUF:350, PLN:4.10,
      ILS:3.58, CLP:820, COP:4400, EGP:30.5, KES:153, RON:4.5, CZK:22.7, BGN:1.8, HRK:6.9,
      PAB:1, BDT:107, LKR:324, UAH:38.5, KWD:0.31, OMR:0.38, QAR:3.64, BHD:0.38, JOD:0.71,
      ISK:145, TWD:31.6, MAD:9.8
      // add more if you want
    };

    // --- Map ISO country codes to currency codes (comprehensive coverage)
    const regionToCurrency = {
      AF: 'AFN', AL: 'ALL', DZ: 'DZD', AS: 'USD', AD: 'EUR', AO: 'AOA', AI: 'XCD', AG: 'XCD',
      AR: 'ARS', AM: 'AMD', AW: 'AWG', AU: 'AUD', AT: 'EUR', AZ: 'AZN', BS: 'BSD', BH: 'BHD',
      BD: 'BDT', BB: 'BBD', BY: 'BYN', BE: 'EUR', BZ: 'BZD', BJ: 'XOF', BM: 'BMD', BT: 'BTN',
      BO: 'BOB', BA: 'BAM', BW: 'BWP', BV: 'NOK', BR: 'BRL', IO: 'USD', BN: 'BND', BG: 'BGN',
      BF: 'XOF', BI: 'BIF', KH: 'KHR', CM: 'XAF', CA: 'CAD', CV: 'CVE', KY: 'KYD', CF: 'XAF',
      TD: 'XAF', CL: 'CLP', CN: 'CNY', CX: 'AUD', CC: 'AUD', CO: 'COP', KM: 'KMF', CG: 'XAF',
      CD: 'CDF', CK: 'NZD', CR: 'CRC', CI: 'XOF', HR: 'HRK', CU: 'CUP', CY: 'EUR', CZ: 'CZK',
      DK: 'DKK', DJ: 'DJF', DM: 'XCD', DO: 'DOP', EC: 'USD', EG: 'EGP', SV: 'USD', GQ: 'XAF',
      ER: 'ERN', EE: 'EUR', ET: 'ETB', FK: 'FKP', FO: 'DKK', FJ: 'FJD', FI: 'EUR', FR: 'EUR',
      GF: 'EUR', PF: 'XPF', TF: 'EUR', GA: 'XAF', GM: 'GMD', GE: 'GEL', DE: 'EUR', GH: 'GHS',
      GI: 'GIP', GR: 'EUR', GL: 'DKK', GD: 'XCD', GP: 'EUR', GU: 'USD', GT: 'GTQ', GG: 'GBP',
      GN: 'GNF', GW: 'XOF', GY: 'GYD', HT: 'HTG', HM: 'AUD', HN: 'HNL', HK: 'HKD', HU: 'HUF',
      IS: 'ISK', IN: 'INR', ID: 'IDR', IR: 'IRR', IQ: 'IQD', IE: 'EUR', IM: 'GBP', IL: 'ILS',
      IT: 'EUR', JM: 'JMD', JP: 'JPY', JE: 'GBP', JO: 'JOD', KZ: 'KZT', KE: 'KES', KI: 'AUD',
      KP: 'KPW', KR: 'KRW', KW: 'KWD', KG: 'KGS', LA: 'LAK', LV: 'EUR', LB: 'LBP', LS: 'LSL',
      LR: 'LRD', LY: 'LYD', LI: 'CHF', LT: 'EUR', LU: 'EUR', MO: 'MOP', MK: 'MKD', MG: 'MGA',
      MW: 'MWK', MY: 'MYR', MV: 'MVR', ML: 'XOF', MT: 'EUR', MH: 'USD', MQ: 'EUR', MR: 'MRU',
      MU: 'MUR', YT: 'EUR', MX: 'MXN', FM: 'USD', MD: 'MDL', MC: 'EUR', MN: 'MNT', ME: 'EUR',
      MS: 'XCD', MA: 'MAD', MZ: 'MZN', MM: 'MMK', NA: 'NAD', NR: 'AUD', NP: 'NPR', NL: 'EUR',
      NC: 'XPF', NZ: 'NZD', NI: 'NIO', NE: 'XOF', NG: 'NGN', NU: 'NZD', NF: 'AUD', MP: 'USD',
      NO: 'NOK', OM: 'OMR', PK: 'PKR', PW: 'USD', PS: 'ILS', PA: 'PAB', PG: 'PGK', PY: 'PYG',
      PE: 'PEN', PH: 'PHP', PN: 'NZD', PL: 'PLN', PT: 'EUR', PR: 'USD', QA: 'QAR', RE: 'EUR',
      RO: 'RON', RU: 'RUB', RW: 'RWF', BL: 'EUR', SH: 'SHP', KN: 'XCD', LC: 'XCD', MF: 'EUR',
      PM: 'EUR', VC: 'XCD', WS: 'WST', SM: 'EUR', ST: 'STN', SA: 'SAR', SN: 'XOF', RS: 'RSD',
      SC: 'SCR', SL: 'SLL', SG: 'SGD', SX: 'ANG', SK: 'EUR', SI: 'EUR', SB: 'SBD', SO: 'SOS',
      ZA: 'ZAR', GS: 'GBP', SS: 'SSP', ES: 'EUR', LK: 'LKR', SD: 'SDG', SR: 'SRD', SJ: 'NOK',
      SZ: 'SZL', SE: 'SEK', CH: 'CHF', SY: 'SYP', TW: 'TWD', TJ: 'TJS', TZ: 'TZS', TH: 'THB',
      TL: 'USD', TG: 'XOF', TK: 'NZD', TO: 'TOP', TT: 'TTD', TN: 'TND', TR: 'TRY', TM: 'TMT',
      TC: 'USD', TV: 'AUD', UG: 'UGX', UA: 'UAH', AE: 'AED', GB: 'GBP', US: 'USD', UM: 'USD',
      UY: 'UYU', UZ: 'UZS', VU: 'VUV', VE: 'VES', VN: 'VND', VG: 'USD', VI: 'USD', WF: 'XPF',
      EH: 'MAD', YE: 'YER', ZM: 'ZMW', ZW: 'ZWL'
    };

    const symbolFallback = {
      USD:'$', EUR:'‚Ç¨', GBP:'¬£', INR:'‚Çπ', JPY:'¬•', CNY:'¬•', KRW:'‚Ç©', PKR:'‚Ç®', CAD:'C$', AUD:'A$',
      BRL:'R$', RUB:'‚ÇΩ', ZAR:'R', NGN:'‚Ç¶', SEK:'kr', NOK:'kr', CHF:'CHF', DKK:'kr', SGD:'S$',
      MXN:'$'
    };

    function detectRegion() {
      try {
        if (typeof Intl === 'object' && typeof Intl.Locale === 'function') {
          const loc = new Intl.Locale(navigator.language || (navigator.languages && navigator.languages[0]) || 'en-US');
          if (loc.region) return loc.region.toUpperCase();
        }
      } catch (e) {}
      const locStr = (navigator.language || (navigator.languages && navigator.languages[0]) || 'en-US').toUpperCase();
      const parts = locStr.split(/[-_]/);
      if (parts.length > 1) return parts[1];
      return 'US';
    }

    function convertUsdTo(amountUsd, currencyCode) {
      const rate = exchangeRates[currencyCode] || exchangeRates['USD'] || 1;
      return amountUsd * rate;
    }

    function formatCurrency(value, currencyCode, locale) {
      try {
        return new Intl.NumberFormat(locale || undefined, { style: 'currency', currency: currencyCode, maximumFractionDigits: currencyCode === 'JPY' ? 0 : 2 }).format(value);
      } catch (e) {
        const sym = symbolFallback[currencyCode] || (currencyCode + ' ');
        return sym + value.toFixed(2);
      }
    }

    function localizePricesOnce() {
      const region = detectRegion();
      const currency = regionToCurrency[region] || 'USD';
      const locale = navigator.language || 'en-US';

      document.querySelectorAll('.price').forEach(el => {
        const overrideAttr = 'data-price-' + currency;
        const perCountry = el.getAttribute(overrideAttr);
        if (perCountry !== null) {
          const raw = parseFloat(perCountry);
          if (!isNaN(raw)) {
            el.textContent = formatCurrency(raw, currency, locale);
            el.setAttribute('data-currency', currency);
            el.setAttribute('data-converted', String(raw));
            return;
          }
        }

        const usdAttr = el.getAttribute('data-price-usd');
        if (!usdAttr) return;
        const usd = parseFloat(usdAttr);
        if (isNaN(usd)) return;
        const converted = convertUsdTo(usd, currency);
        el.textContent = formatCurrency(converted, currency, locale);
        el.setAttribute('data-currency', currency);
        el.setAttribute('data-converted', String(converted));
      });

      document.querySelectorAll('[data-buy-price-usd]').forEach(btn => {
        const usdAttr = btn.getAttribute('data-buy-price-usd');
        if (!usdAttr) return;
        const usd = parseFloat(usdAttr);
        if (isNaN(usd)) return;
        const converted = convertUsdTo(usd, currency);
        const formatted = formatCurrency(converted, currency, locale);
        if (/buy/i.test(btn.textContent)) {
          btn.textContent = 'Buy ‚Ä¢ ' + formatted;
        } else {
          btn.textContent = formatted;
        }
        btn.setAttribute('data-currency', currency);
        btn.setAttribute('data-converted', String(converted));
      });

      console.info('Detected region:', region, 'currency:', currency);
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', localizePricesOnce);
    } else {
      localizePricesOnce();
    }

    window.MineRiseCurrency = {
      rates: exchangeRates,
      regionToCurrency,
      detectRegion,
      localize: localizePricesOnce,
      updateRates(newRates) { Object.assign(exchangeRates, newRates); localizePricesOnce(); }
    };
  })();
  </script>

  <!-- tiny UI scripts (theme toggle, tilt) + simple shop simulation -->
  <script>
  (function(){
    // theme toggle
    const THEME_KEY='mr_theme';
    function applyTheme(t){ document.documentElement.setAttribute('data-theme', t); document.querySelectorAll('#theme-toggle').forEach(b=>b.textContent = t==='dark' ? 'üåô' : '‚òÄÔ∏è'); localStorage.setItem(THEME_KEY,t); }
    const saved = localStorage.getItem(THEME_KEY) || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'); applyTheme(saved);
    document.querySelectorAll('#theme-toggle').forEach(b=>b.addEventListener('click', ()=>{ const cur = document.documentElement.getAttribute('data-theme') || 'dark'; applyTheme(cur==='dark' ? 'light' : 'dark'); }));

    // tilt micro interaction
    document.addEventListener('mousemove', (e)=>{
      document.querySelectorAll('.tilt').forEach(el=>{
        const r = el.getBoundingClientRect();
        const px = (e.clientX - r.left) / r.width;
        const py = (e.clientY - r.top) / r.height;
        if (px>=0 && px<=1 && py>=0 && py<=1) {
          const rx = (py - 0.5) * 10;
          const ry = (px - 0.5) * -14;
          el.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg) translateZ(8px)`;
          el.style.boxShadow = '0 30px 80px rgba(2,8,20,0.48)';
        } else {
          el.style.transform = '';
          el.style.boxShadow = '';
        }
      });
    });
    document.addEventListener('mouseleave', ()=>{ document.querySelectorAll('.tilt').forEach(el=>{ el.style.transform=''; el.style.boxShadow=''; }); });

    // --- simple local "shop" state for demo (keys/shards/coins stored in localStorage)
    const STORAGE_KEY = 'minerise_store_v1';
    const defaultState = { keys:0, rankKeys:0, shards:0, coins:0, ownedRank: null, lastClaim: 0 };
    function loadState(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultState; } catch(e){ return defaultState; } }
    function saveState(s){ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); renderBalances(); }

    function renderBalances(){
      const s = loadState();
      document.getElementById('balance-keys').textContent = 'Keys: ' + (s.keys||0);
      document.getElementById('balance-rankkeys').textContent = 'Rank Keys: ' + (s.rankKeys||0);
      document.getElementById('balance-shards').textContent = 'Shards: ' + (s.shards||0);
      document.getElementById('balance-coins').textContent = 'Coins: ' + (s.coins||0);
    }

    function toast(msg){
      const t = document.getElementById('toast');
      if(!t) return alert(msg);
      t.textContent = msg;
      t.style.display = 'block';
      clearTimeout(t._hide);
      t._hide = setTimeout(()=> t.style.display = 'none', 2200);
    }

    // buy simulation: increment relevant balance. Prices not deducted (demo).
    window.buy = function(item){
      const s = loadState();
      switch(item){
        case 'bat': s.ownedRank = 'bat'; toast('Bought Bat rank (demo). You now get 1 daily key.'); break;
        case 'warden': s.ownedRank = 'warden'; toast('Bought Warden rank (demo). You now get 1 daily key.'); break;
        case 'rise': s.ownedRank = 'rise'; toast('Bought Rise rank (demo). You now get 1 daily key.'); break;
        case 'key': s.keys = (s.keys||0) + 1; toast('Key purchased (demo)'); break;
        case 'rankKey': s.rankKeys = (s.rankKeys||0) + 1; toast('Rank Key purchased (demo)'); break;
        case 'shards': s.shards = (s.shards||0) + 5; toast('Shard pack purchased (demo) +5'); break;
        case 'coins': s.coins = (s.coins||0) + 50; toast('Coin pack purchased (demo) +50'); break;
        default: toast('Unknown item'); break;
      }
      saveState(s);
    };

    window.gift = function(rank){
      toast('Gift flow placeholder ‚Äî open your Discord/Tebex to gift'); // keep placeholder
    };

    // daily key claim: allow one claim every 24 hours if user owns a rank
    window.claimDailyKey = function(){
      const s = loadState();
      if(!s.ownedRank){ toast('No rank found ‚Äî buy a rank to get daily key'); return; }
      const now = Date.now();
      const last = s.lastClaim || 0;
      const day = 24*60*60*1000;
      if (now - last < day){ const next = new Date(last + day); toast('Daily key already claimed ‚Äî next at: ' + next.toLocaleString()); return; }
      s.keys = (s.keys||0) + 1;
      s.lastClaim = now;
      saveState(s);
      toast('Daily key claimed! +1 Key');
    };

    // init
    document.addEventListener('DOMContentLoaded', ()=>{
      renderBalances();
      // try to init 3D if available later (threeScene loader is below)
      setTimeout(()=>{ if(typeof window.initThree==='function') try{ window.initThree({}); }catch(e){ console.warn(e); } }, 700);
    });
  })();
  </script>

  <!-- minimal threeScene loader (optional) - same as index; it's fine to remove if you don't want 3D -->
  <script>
  (function(){
    const THREE_CDN = 'https://unpkg.com/three@0.152.2/build/three.min.js';
    function loadScript(src){ return new Promise((res,rej)=>{ if(document.querySelector('script[src="'+src+'"]')) return res(); const s=document.createElement('script'); s.src=src; s.async=true; s.onload=()=>res(); s.onerror=(e)=>rej(e); document.head.appendChild(s); }); }
    window.initThree = window.initThree || (async function initThree(opts={}) {
      if (typeof window.THREE === 'undefined') { try { await loadScript(THREE_CDN); } catch(e) { console.warn('three load failed', e); return; } }
      const THREE = window.THREE; if(!THREE) return;
      let container = document.getElementById('three-container'); if(!container){ container = document.createElement('div'); container.id='three-container'; document.body.appendChild(container); }
      if(container.__initialized) return; container.__initialized=true;
      const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio||1,2));
      renderer.domElement.style.position='fixed'; renderer.domElement.style.inset='0'; renderer.domElement.style.zIndex='0'; renderer.domElement.style.pointerEvents='none';
      container.appendChild(renderer.domElement);

      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 2000);
      camera.position.set(0,2.2,7);

      scene.add(new THREE.AmbientLight(0xffffff,0.6));
      const dir = new THREE.DirectionalLight(0xffb86b,0.9); dir.position.set(5,10,5); scene.add(dir);

      function makePumpkin(s=1,c=0xff8a2b){
        const g = new THREE.Group();
        const body = new THREE.Mesh(new THREE.SphereGeometry(0.9*s,16,12), new THREE.MeshStandardMaterial({ color:c, roughness:0.6, metalness:0.05 }));
        body.scale.y = 0.8; g.add(body);
        const st = new THREE.Mesh(new THREE.CylinderGeometry(0.06*s,0.12*s,0.35*s,8), new THREE.MeshStandardMaterial({ color:0x3b2b18 }));
        st.position.y = 0.9*s; st.rotation.x = 0.2; g.add(st);
        return g;
      }

      const pumpkins=[]; for(let i=0;i<6;i++){ const s=0.6+Math.random()*0.9; const p=makePumpkin(s); p.position.set((Math.random()-0.5)*8,(Math.random()-0.25)*2+1,(Math.random()-0.5)*6); p.rotation.y=Math.random()*Math.PI*2; scene.add(p); pumpkins.push({mesh:p,speed:0.2+Math.random()*0.6,yo:p.position.y}); }

      let t=0;
      function animate(){
        t+=0.01;
        pumpkins.forEach((p,i)=>{ p.mesh.position.y = p.yo + Math.sin(t*p.speed + i) * 0.22; p.mesh.rotation.y += 0.002; });
        renderer.render(scene,camera);
        requestAnimationFrame(animate);
      }
      animate();

      window.addEventListener('resize', ()=>{ renderer.setSize(window.innerWidth, window.innerHeight); camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); });
    });
    // try to init right away
    setTimeout(()=>{ if(typeof window.initThree==='function') try{ window.initThree({}); }catch(e){console.warn(e)} },700);
  })();
  </script>
</body>
</html>
